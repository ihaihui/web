webpackJsonp([10],{621:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=a(627),o=n(u),c=a(651),f=n(c),d=a(642),m=n(d),h=a(641),p=n(h),v=a(300),g=n(v),E=a(42),y=n(E),C=a(99),b=n(C),I=a(100),w=n(I),k=a(56),L=n(k),N=a(12),S=n(N),P=a(629),T=n(P),M=a(652),x=n(M),O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},B=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();a(628),a(661),a(644),a(643),a(299),a(43),a(101),a(102),a(57),a(61),a(631),a(653);var U=a(671),A=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(U),j=a(626),D=n(j),H=a(0),V=n(H),R=x.default.RangePicker,Y=T.default.Option,z=function(t){return e.createElement("div",null,e.createElement(S.default,{type:"plus"}),e.createElement("div",{className:"ant-upload-text"},t))},F=function(t){function a(e){s(this,a);var t=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={courseIds:[],courseInfo:[],courseCover:"",previewVisible:!1,previewImage:"",fileList:[],loading:!1,fitMoney:"",title:"",type:1,balance:0,bgPicUrl:"",useMoneyLimit:0,dateData:[],validBeginTime:"",validEndTime:"",totalCount:"",everyCountLimit:"",enableAllCourse:"",label:"",appleProductList:[]},t}return i(a,t),B(a,[{key:"componentDidMount",value:function(){var e=this;if(this.props.location.state){var t={couponId:this.props.location.state.couponId};A.getCouponInfoById(t).then(function(t){var a=t.data;e.setState({fitMoney:0==a.useMoneyLimit?0:1,dateData:[(0,V.default)(a.validBeginTime),(0,V.default)(a.validEndTime)],title:a.title,type:parseInt(a.type),balance:parseFloat(a.balance)||0,bgPicUrl:a.bgPicUrl,useMoneyLimit:parseInt(a.useMoneyLimit)||0,validBeginTime:a.validBeginTime,validEndTime:a.validEndTime,totalCount:parseInt(a.totalCount),everyCountLimit:a.everyCountLimit,courseIds:a.courseIdList,enableAllCourse:parseInt(a.enableAllCourse),label:a.label,fileList:[{uid:"-1",name:"xxx.png",status:"done",response:{data:{fileUrl:a.bgPicUrl}},url:a.bgPicUrl}]},function(){"selectCourse"==e.props.location.state.source?e.setState({courseIds:e.props.location.state.data},function(){e.getCourseInfoByCourseIds()}):e.getCourseInfoByCourseIds()})})}}},{key:"getCourseInfoByCourseIds",value:function(){var e=this;A.getCourseInfoById(this.state.courseIds).then(function(t){var a=t.data;e.setState({courseInfo:a,courseTitle:a.courseTitle})})}},{key:"handlePreview",value:function(e){this.setState({previewImage:e.response.data.fileUrl,previewVisible:!0})}},{key:"imgHandleCancel",value:function(){this.setState({previewVisible:!1})}},{key:"upLoadChange",value:function(e){var t=e.fileList;this.setState({fileList:t}),t.length&&"done"===t[0].status?(L.default.success(t[0].name+" 上传成功！"),this.setState({bgPicUrl:t[0].response.data.key})):t.length&&"error"===t[0].status&&L.default.error(t[0].name+" 上传失败！")}},{key:"limitSelectChange",value:function(e){this.setState({everyCountLimit:e})}},{key:"cancel",value:function(){this.props.history.push("coupon")}},{key:"inputChange",value:function(e,t){this.setState(l({},t,e.target.value))}},{key:"typeSelectChange",value:function(e){this.setState({type:e})}},{key:"balanceInputChange",value:function(e){if(2===this.state.type&&e>=1)return L.default.error("当选择类型为折扣券时，所填写的面额需要小于1"),void this.setState({balance:0});this.setState({balance:e})}},{key:"useMoneyLimitChange",value:function(e){0===e.target.value&&this.setState({useMoneyLimit:""}),this.setState({fitMoney:e.target.value})}},{key:"moneyChange",value:function(e){this.setState({useMoneyLimit:e.target.value})}},{key:"onDateChange",value:function(e,t){this.setState({dateData:[(0,V.default)(t[0]),(0,V.default)(t[1])],validBeginTime:t[0],validEndTime:t[1]})}},{key:"onOk",value:function(e){}},{key:"totalCountInputChange",value:function(e){this.setState({totalCount:e})}},{key:"enableAllCourseRadioChange",value:function(e){this.setState({enableAllCourse:e.target.value})}},{key:"submit",value:function(){var e=this;if(!this.state.title)return L.default.warning("请输入优惠券名称！"),!1;if(!this.state.type)return L.default.warning("请输入优惠券类型！"),!1;if(!this.state.balance)return L.default.warning("请输入优惠券面额！"),!1;if(!this.state.bgPicUrl)return L.default.warning("请上传优惠券背景图！"),!1;if(!this.state.validBeginTime||!this.state.validBeginTime)return L.default.warning("请输入开始时间和结束时间！"),!1;if(!this.state.totalCount)return L.default.warning("请输入发行总量！"),!1;if(!this.state.everyCountLimit)return L.default.warning("请选择每人限额！"),!1;if(!this.state.label)return L.default.warning("请选择分组名称！"),!1;var t={couponId:this.props.location.state.couponId,courseIdList:1==this.state.enableAllCourse?[]:this.state.courseIds,title:this.state.title||"",type:parseInt(this.state.type),balance:parseFloat(this.state.balance)||0,bgPicUrl:this.state.bgPicUrl.length>37?null:this.state.bgPicUrl,useMoneyLimit:parseInt(this.state.useMoneyLimit)||0,validBeginTime:this.state.validBeginTime||"",validEndTime:this.state.validEndTime||"",totalCount:parseInt(this.state.totalCount),everyCountLimit:parseInt(this.state.everyCountLimit),enableAllCourse:parseInt(this.state.enableAllCourse),label:this.state.label||""};A.editCoupon(t).then(function(t){L.default.success("修改优惠券成功！"),setTimeout(function(){e.props.history.push("/coupon")},1500)})}},{key:"goBack",value:function(){if(this.state.courseIds.length&&this.state.courseInfo.length)for(var e=[],t=0,a=0;a<this.state.courseIds.length;a++)for(var n=0;n<this.state.courseInfo.length;n++)this.state.courseIds[a]==this.state.courseInfo[n].courseId&&(e[t]=this.state.courseIds[a],++t);this.setState({courseIds:e},function(){window.history.go(-1)})}},{key:"addCourse",value:function(){var e={pathname:"/selectCourse",state:{source:"editCoupon",data:this.state.courseIds,couponId:this.props.location.state.couponId}};this.props.history.push(e)}},{key:"deleteCourse",value:function(e){this.state.courseInfo.splice(e,1);for(var t=[],a=0,n=0;n<this.state.courseIds.length;n++)for(var l=0;l<this.state.courseInfo.length;l++)this.state.courseIds[n]==this.state.courseInfo[l].courseId&&(t[a]=this.state.courseIds[n],++a);this.setState({courseInfo:this.state.courseInfo,courseIds:t})}},{key:"render",value:function(){var t=this,a={name:"inputFile",action:"http://39.98.32.147:58081/course/admin/file-upload/upload-img",listType:"picture-card",headers:{token:_.getStore("tz_token")}},n=this.state,l=n.previewVisible,s=n.previewImage,r=n.fileList,i={display:"block",height:"30px",lineHeight:"30px"},u=this.state.courseInfo.map(function(a,n){return e.createElement("div",{key:n},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"}),e.createElement(w.default,{span:16},e.createElement("div",{className:"course-container"},e.createElement("img",{src:a.qrCodePicUrl,alt:""}),e.createElement("span",null,a.courseTitle),e.createElement("span",{className:"close",onClick:function(e){t.deleteCourse(n)},style:{marginLeft:15}},e.createElement(S.default,{type:"close"}))))))});return e.createElement("div",null,e.createElement(D.default,{title:"优惠券管理 / 编辑优惠券"}),e.createElement("div",{className:"addCourse-wrap"},e.createElement(b.default,{style:{marginBottom:30}},e.createElement(y.default,{onClick:function(){return t.goBack()}},"返回")),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"优惠券名称")),e.createElement(w.default,{span:16},e.createElement(g.default,{size:"large",value:this.state.title,onChange:function(e){return t.inputChange(e,"title")},placeholder:"请输入优惠券名称"})))),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"选择类型")),e.createElement(w.default,{span:16},e.createElement(T.default,{defaultValue:"请选择",style:{width:120},value:this.state.type,onChange:this.typeSelectChange.bind(this)},e.createElement(Y,{value:1},"优惠券"),e.createElement(Y,{value:2},"折扣券"))))),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"面额")),e.createElement(w.default,{span:10},e.createElement(p.default,{costPrice:!0,min:0,max:1e4,step:.01,value:this.state.balance,onChange:function(e){return t.balanceInputChange(e)}})))),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"h5背景图")),e.createElement(w.default,{span:16},e.createElement(m.default,O({},a,{fileList:r,onPreview:function(e){return t.handlePreview(e)},onChange:function(e){return t.upLoadChange(e)}}),r.length<1?z("h5背景图"):null)))),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"适用金额")),e.createElement(w.default,{span:16},e.createElement(f.default.Group,{onChange:function(e){return t.useMoneyLimitChange(e)},value:this.state.fitMoney},e.createElement(f.default,{style:i,value:1},"满"," ",e.createElement(g.default,{onChange:function(e){return t.moneyChange(e)},value:this.state.useMoneyLimit,disabled:0===this.state.fitMoney,style:{width:100,marginLeft:10}})," 元可使用"),e.createElement(f.default,{style:i,value:0},"无门槛使用"))))),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"有效时间")),e.createElement(w.default,{span:16},e.createElement(R,{style:{width:450},allowClear:!1,value:this.state.dateData,onChange:function(e,a){return t.onDateChange(e,a)},onOk:function(e){return t.onOk(e)},showTime:{format:"HH:mm:ss"},format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"]})))),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"发行总量")),e.createElement(w.default,{span:16},e.createElement(p.default,{placeholder:"请输入发行总量",style:{width:200},min:1,max:9999,step:1,value:this.state.totalCount,onChange:function(e){return t.totalCountInputChange(e)}})))),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"每人限额")),e.createElement(w.default,{span:16},e.createElement(T.default,{defaultValue:"请选择",value:this.state.everyCountLimit,style:{width:120},onChange:this.limitSelectChange.bind(this)},e.createElement(Y,{value:1},"1"),e.createElement(Y,{value:2},"2"),e.createElement(Y,{value:3},"3"),e.createElement(Y,{value:4},"4"),e.createElement(Y,{value:5},"5"),e.createElement(Y,{value:6},"6"),e.createElement(Y,{value:7},"7"),e.createElement(Y,{value:8},"8"),e.createElement(Y,{value:9},"9"),e.createElement(Y,{value:10},"10"))))),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"适用课程")),e.createElement(w.default,{span:16},e.createElement(f.default.Group,{onChange:function(e){return t.enableAllCourseRadioChange(e)},value:this.state.enableAllCourse},e.createElement(f.default,{style:i,value:1},"所有课程可用"),e.createElement(f.default,{style:i,value:0},"部分课程可用",0===this.state.enableAllCourse?e.createElement(y.default,{style:{marginLeft:25},type:"primary",onClick:function(e){t.addCourse(e)}},"添加课程"):null)))),e.createElement("div",null,this.state.courseInfo.length>0&&0==this.state.enableAllCourse?u:null)),e.createElement("div",{className:"rowbox"},e.createElement(b.default,null,e.createElement(w.default,{span:4,className:"title"},e.createElement("span",null,"分组名称")),e.createElement(w.default,{span:16},e.createElement(g.default,{size:"large",value:this.state.label,onChange:function(e){return t.inputChange(e,"label")},placeholder:"请输入分组名称，6个字以内"})))),e.createElement("div",{className:"rowbox"},e.createElement("div",{className:"btn-group"},e.createElement(y.default,{onClick:function(){return t.cancel()}},"取消"),e.createElement(y.default,{type:"primary",className:"save-btn",onClick:function(){return t.submit()}},"保存")))),e.createElement(o.default,{visible:l,footer:null,onCancel:function(e){return t.imgHandleCancel(e)}},e.createElement("img",{alt:"image",style:{width:"100%"},src:s})))}}]),a}(e.Component);t.default=F}).call(t,a(1))}});