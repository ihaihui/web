webpackJsonp([16],{611:function(e,t,a){"use strict";(function(e){function l(e){return e&&e.__esModule?e:{default:e}}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=a(627),r=l(u),d=a(42),c=l(d),f=a(641),p=l(f),h=a(99),m=l(h),y=a(300),v=l(y),g=a(100),b=l(g),E=a(642),U=l(E),T=a(12),S=l(T),C=a(56),k=l(C),w=a(629),I=l(w),x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},A=function(){function e(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,a,l){return a&&e(t.prototype,a),l&&e(t,l),t}}();a(628),a(43),a(643),a(101),a(299),a(102),a(644),a(61),a(57),a(631);var O=a(1),V=l(O);a(686);var D=a(687),L=l(D),N=a(663),M=(a(670),a(790)),P=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(M),j=a(626),q=l(j);a(756);var z,H=I.default.Option,F=function(t){function a(e){s(this,a);var t=o(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return e.match.params.id,t.state={imageUrl:"",editorState:L.default.createEditorState(),outputHTML:"",visible:!1,titleValue:"",subTitleValue:"",showOrder:"",fileList:[],imgUrl:"",fileUrl:"",subtitle:"",contentType:"",fileList1:[],isShowSelect:!1,imageUrlOld:"",timeout:"",partSize:"",parallel:"",retryCount:"",retryDuration:"",region:"cn-shanghai",userId:"1303984639806000",file:null,authProgress:0,uploadDisabled:!0,resumeDisabled:!0,pauseDisabled:!0,uploader:null,statusText:"未选择文件"},t.parseDom=t.parseDom.bind(t),t}return i(a,t),A(a,[{key:"componentDidMount",value:function(){if(z=this,z.isLivinig=!0,setTimeout(z.setEditorContentAsync,3e3),this.getInitialData(),z.props.location.state.classListLength&&!0===z.props.location.state.classListLength&&z.setState({isShowSelect:!0}),z.props.location.state&&z.props.location.state.courseContentId){var e=z.props.location.state.courseContentId;z.getCourseContentDetail({courseContentId:e})}}},{key:"getVodUploadConfig",value:function(e){var t=this,a={fileName:e};P.getVodConfig(a).then(function(e){t.setState({requestId:e.data.requestId,uploadAuth:e.data.uploadAuth,uploadAddress:e.data.uploadAddress,videoId:e.data.videoId})})}},{key:"refreshVodUploadConfig",value:function(e){var t=this,a={videoId:e};P.getVodConfig(a).then(function(e){t.setState({requestId:e.data.requestId,uploadAuth:e.data.uploadAuth,uploadAddress:e.data.uploadAddress,videoId:e.data.videoId})})}},{key:"getCourseContentDetail",value:function(e){var t=this;P.getCourseContentDetail(e).then(function(e){if(200===e.code){var a=e.data,l=a.contentThemeUrl&&a.contentThemeUrl.indexOf("?"),n=a.contentThemeUrl&&a.contentThemeUrl.slice(0,l);t.setState({imageUrl:n,titleValue:a.contentTitle,subTitleValue:a.subtitle,contentType:a.contentType,fileUrl:a.mediaUrl,parentContentId:a.rootId,rootId:a.rootId,showOrder:a.showOrder,outputHTML:a.materials,contentState:a.contentState,editorState:L.default.createEditorState(a.materials)})}}).catch(function(e){})}},{key:"componentWillUnmount",value:function(){this.isLivinig=!1}},{key:"handeleBeforeUpload",value:function(e){}},{key:"handleEditorChange",value:function(e){this.setState({editorState:e,outputHTML:"<!doctype html><html lang='en'><head><meta charset='UTF-8'><meta name='viewport' content='width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0'></head><body>"+e.toHTML()+"</body></html>"})}},{key:"getInitialData",value:function(){var e=this.props.location.state;this.setState({rootId:e.rootId})}},{key:"titleValue",value:function(e){this.setState({titleValue:e.target.value})}},{key:"subTitleValue",value:function(e){this.setState({subTitleValue:e.target.value})}},{key:"showOrderValue",value:function(e){this.setState({showOrder:e})}},{key:"uploadHandler",value:function(e){var t=this;if(!e.file)return!1;e.file.size>1048576&&k.default.error("上传的图片不能超过1MB");var a=new XMLHttpRequest,l=new FormData;l.append("inputFile",e.file),a.open("POST","http://39.98.32.147:58081/course/admin/file-upload/upload-img",!0),a.setRequestHeader("token",""+_.getStore("tz_token")),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=JSON.parse(a.response);e.data&&t.setState({editorState:N.ContentUtils.insertMedias(t.state.editorState,[{type:"IMAGE",url:e.data.fileUrl}])}),e.data&&e.data&&k.default.success("图片添加成功",1)}},a.send(l)}},{key:"setEditorContentAsync",value:function(){this.isLivinig&&this.setState({editorState:L.default.createEditorState()})}},{key:"parseDom",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes}},{key:"handleSubmit",value:function(){if(!this.state.titleValue)return k.default.warning("请输入课程内容名称！"),!1;var e=n({contentTitle:this.state.titleValue,subtitle:this.state.subTitleValue,contentType:this.props.location.state&&this.props.location.state.contentType?this.props.location.state.contentType:this.state.contentType,materials:this.state.outputHTML,mediaUrl:this.state.fileUrl,parentContentId:this.state.rootId,rootId:this.state.rootId,showOrder:this.state.showOrder,contentState:this.state.contentType?this.state.contentType:"release",courseContentId:this.props.location.state&&this.props.location.state&&this.props.location.state.courseContentId},"subtitle",this.state.subtitle);P.saveCourseContent(Object.assign({},e,this.state.imgUrl&&{contentThemeUrl:this.state.imgUrl})).then(function(e){200===e.code&&(k.default.success("保存成功",.8),setTimeout(function(){window.history.back(-1)},1e3))})}},{key:"goBack",value:function(){this.props.history.goBack()}},{key:"handleOk",value:function(){this.setState({visible:!1})}},{key:"handleCancel",value:function(){this.setState({visible:!1})}},{key:"handleChange",value:function(e){var t=e.fileList;if(this.setState({fileList:t}),t.length&&"done"===t[0].status){if(k.default.success(t[0].name+" 上传成功！"),t[0].response&&t[0].response.data&&t[0].response.data.fileUrl){var a=t[0].response.data.fileUrl.indexOf("?");this.setState({imgUrl:t[0].response.data.key,imageUrl:t[0].response.data.fileUrl.slice(0,a)})}}else t.length&&"error"===t[0].status&&k.default.error(t[0].name+" 上传失败！")}},{key:"typeChange",value:function(e){this.setState({contentType:e})}},{key:"fileChange",value:function(e){if(this.setState({file:e.target.files[0]}),this.state.file=e.target.files[0],!this.state.file)return void k.default.error("请先选择需要上传的文件!");this.state.uploader&&(this.uploader.stopUpload(),this.state.authProgress=0,this.state.statusText=""),this.state.uploader=this.createUploader(),this.state.uploader.addFile(this.state.file,null,null,null,'{"Vod":{}}')}},{key:"createUploader",value:function(t){var a=this,l=new AliyunUpload.Vod({timeout:a.state.timeout||6e4,partSize:a.state.partSize||1048576,parallel:a.state.parallel||5,retryCount:a.state.retryCount||3,retryDuration:a.state.retryDuration||2,region:a.state.region,userId:a.state.userId,addFileSuccess:function(e){a.state.statusText="添加文件成功, 等待上传..."},onUploadstarted:function(e){if(e.videoId){var t={videoId:e.videoId};P.refreshVodConfig(t).then(function(e){a.setState({requestId:e.data.requestId,uploadAuth:e.data.uploadAuth,uploadAddress:e.data.uploadAddress,videoId:e.data.videoId})},function(){l.setUploadAuthAndAddress(e,a.state.uploadAuth,a.state.uploadAddress,a.state.videoId)})}else{var n=a.state.rootId+"_"+a.state.file.name,s={fileName:n};P.getVodConfig(s).then(function(t){a.setState({requestId:t.data.requestId,uploadAuth:t.data.uploadAuth,uploadAddress:t.data.uploadAddress,videoId:t.data.videoId},function(){l.setUploadAuthAndAddress(e,a.state.uploadAuth,a.state.uploadAddress,a.state.videoId)})}),a.statusText="文件开始上传..."}},onUploadSucceed:function(e){a.state.statusText="文件上传成功!",a.setState({fileUrl:"http://tzapp.banju.net/"+e.object}),k.default.success("文件上传成功!")},onUploadFailed:function(e,t,l){a.state.statusText="文件上传失败!",l.error("文件上传失败!")},onUploadCanceled:function(e,t,l){a.state.statusText="文件已暂停上传",l.info("文件已暂停上传!")},onUploadProgress:function(e,t,l){var n=Math.ceil(100*l);a.setState({authProgress:n}),a.state.authProgress=n,a.state.statusText="文件上传中..."},onUploadTokenExpired:function(t){var n="https://demo-vod.cn-shanghai.aliyuncs.com/voddemo/RefreshUploadVideo?BusinessType=vodai&TerminalType=pc&DeviceModel=iPhone9,2&UUID=59ECA-4193-4695-94DD-7E1247288&AppVersion=1.0.0&Title=haha1&FileName=xxx.mp4&VideoId="+t.videoId;e.get(n).then(function(e){var t=e.data,a=t.UploadAuth;l.resumeUploadWithAuth(a)}),a.state.statusText="文件超时..."},onUploadEnd:function(e){a.state.statusText="文件上传完毕"}});return l}},{key:"authUpload",value:function(){null!==this.state.uploader&&(this.state.uploader.startUpload(),this.state.uploadDisabled=!0,this.state.pauseDisabled=!1)}},{key:"pauseUpload",value:function(){null!==this.state.uploader&&(this.state.uploader.stopUpload(),this.state.resumeDisabled=!1,this.state.pauseDisabled=!0)}},{key:"resumeUpload",value:function(){null!==this.state.uploader&&(this.state.uploader.startUpload(),this.state.resumeDisabled=!0,this.state.pauseDisabled=!1)}},{key:"render",value:function(){var e=this,t=this,a={name:"inputFile ",action:"http://39.98.32.147:58081/course/admin/file-upload/upload-srt",headers:{token:_.getStore("tz_token")},onChange:function(e){"done"===e.file.status?(e.file.response&&e.file.response.data&&e.file.response.data.key&&t.setState({subtitle:e.fileList[0].response.data.key}),k.default.success(e.file.name+" 上传成功！")):"error"===e.file.status?k.default.error(e.file.name+" 上传失败"):0===e.fileList.length&&t.setState({subtitle:""})}},l={name:"inputFile",action:"http://39.98.32.147:58081/course/admin/file-upload/upload-img",listType:"picture-card",headers:{token:_.getStore("tz_token")}},s=this.state,o=(s.previewVisible,s.previewImage,s.fileList),i=V.default.createElement("div",null,V.default.createElement(S.default,{type:"plus"}),V.default.createElement("div",{className:"ant-upload-text"},"上传图片")),u=this.state,d=u.editorState,f=(u.outputHTML,[{key:"antd-uploader",type:"component",component:V.default.createElement(U.default,{accept:"image/*",showUploadList:!1,customRequest:function(t){return e.uploadHandler(t)}},V.default.createElement("button",{type:"button",className:"control-item button upload-button","data-title":"插入图片"},V.default.createElement(S.default,{type:"picture",theme:"filled"})))}]),h=["media"];return V.default.createElement("div",null,V.default.createElement(q.default,{title:"添加课时/编辑课时"}),V.default.createElement("div",{className:"addCourse-wrap"},V.default.createElement("h1",null,"音频内容"),V.default.createElement(m.default,{className:"rowbox"},V.default.createElement(b.default,{span:4},V.default.createElement("span",null,"内容名称")),V.default.createElement(b.default,{span:16},V.default.createElement(v.default,{size:"large",placeholder:"请输入课程内容名称",value:this.state.titleValue,onChange:function(t){return e.titleValue(t)}}))),V.default.createElement(m.default,{className:"rowbox"},V.default.createElement(b.default,{span:4},V.default.createElement("span",null,"副标题")),V.default.createElement(b.default,{span:16},V.default.createElement(v.default,{size:"large",placeholder:"请输入课程内容副标题",value:this.state.subTitleValue,onChange:function(t){return e.subTitleValue(t)}}))),V.default.createElement(m.default,{className:"rowbox"},V.default.createElement(b.default,{span:4},V.default.createElement("span",null,"课时序号:")),V.default.createElement(b.default,null,V.default.createElement(p.default,{min:-1e4,max:1e4,step:.1,defaultValue:1,value:this.state.showOrder,onChange:function(t){return e.showOrderValue(t)}}))),this.state.isShowSelect&&V.default.createElement(m.default,{className:"rowbox"},V.default.createElement(b.default,{span:4},V.default.createElement("span",null,"内容类型")),V.default.createElement(b.default,{span:16,style:{display:"flex"}},V.default.createElement(I.default,{defaultValue:"",placeholder:"请选择类型",style:{width:120},onChange:this.typeChange.bind(this)},V.default.createElement(H,{value:"AUDIO"},"音频"),V.default.createElement(H,{value:"VIDEO"},"视频")))),V.default.createElement(m.default,{className:"rowbox"},V.default.createElement(b.default,{span:4},V.default.createElement("span",null,this.props.location.state&&this.props.location.state.contentType&&this.props.location.state.contentType?"AUDIO"===this.props.location.state.contentType?"音频上传":"视频上传":this.props.location.state.classListLength&&!0!==this.props.location.state.classListLength?"AUDIO"===this.props.location.state.contentType?"音频上传":"视频上传":"音视频上传")),V.default.createElement(b.default,{span:16,style:{display:"flex"}},V.default.createElement(v.default,{size:"large",value:this.state.fileUrl,disabled:!0})),V.default.createElement(b.default,n({span:24,style:{display:"flex"}},"style",{marginTop:15}),V.default.createElement("input",{className:"upload-input",type:"file",id:"fileUpload",onChange:function(t){return e.fileChange(t)}}),V.default.createElement(c.default,{type:"primary",style:{marginRight:10},onClick:function(){return e.authUpload()}},"开始上传"),V.default.createElement("label",{className:"status"},"上传状态: ",V.default.createElement("b",null,this.state.statusText)),V.default.createElement("span",{className:"progress",style:{marginLeft:10}},"上传进度: ",V.default.createElement("b",{id:"auth-progress"},this.state.authProgress,"%")))),V.default.createElement(m.default,{className:"rowbox"},V.default.createElement(b.default,{span:4},V.default.createElement("span",null,"音频封面")),V.default.createElement(b.default,{span:16,style:{display:"flex"}},V.default.createElement("div",{style:{width:"100px",height:"100px",marginRight:"20px"}},V.default.createElement("img",{style:{width:"100%",height:"100%"},src:this.state.imageUrl,alt:""})),V.default.createElement(U.default,x({},l,{fileList:o,onPreview:function(t){return e.handlePreview(t)},onChange:function(t){return e.handleChange(t)}}),o.length<1?i:null))),V.default.createElement(m.default,{className:"rowbox"},V.default.createElement(b.default,{span:4},V.default.createElement("span",null,"srt文件上传")),V.default.createElement(b.default,{span:16,style:{display:"flex"}},V.default.createElement(U.default,a,0==this.state.subtitle.length?V.default.createElement(c.default,{className:"upload-btn",style:{height:"40px",marginLeft:"20px"}},V.default.createElement(S.default,{type:"upload"}),"点击上传"):null))),V.default.createElement(m.default,{className:"rowbox"},V.default.createElement(b.default,{span:4},V.default.createElement("span",null,"讲义内容")),V.default.createElement(b.default,{span:16},V.default.createElement("div",{className:"editor-wrapper"},V.default.createElement(L.default,{placehoder:"请输入内容...",value:d,onChange:function(t){return e.handleEditorChange(t)},excludeControls:h,extendControls:f,contentStyle:{height:300,boxShadow:"0px 1px 1px 1px rgba(0,0,0,.1)"}})))),V.default.createElement("div",{className:"rowbox"},V.default.createElement("div",{className:"btn-group"},V.default.createElement(c.default,{onClick:function(){return e.goBack()}},"取消"),V.default.createElement(c.default,{type:"primary",className:"save-btn",onClick:function(t){return e.handleSubmit(t)}},"保存"))),V.default.createElement(r.default,{title:"banner图",visible:this.state.visible,footer:[V.default.createElement(c.default,{key:"back",onClick:function(){return e.handleCancel()}},"取消"),V.default.createElement(c.default,{key:"submit",type:"primary",onClick:function(){return e.handleOk()}},"确定")]},V.default.createElement("p",null,this.state.infoMsg))))}}]),a}(V.default.Component);t.default=F}).call(t,a(62))}});