webpackJsonp([21],{616:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=a(627),o=l(u),c=a(42),d=l(c),f=a(641),p=l(f),m=a(99),h=l(m),E=a(300),g=l(E),v=a(100),y=l(v),P=a(642),C=l(P),L=a(56),b=l(L),w=a(12),S=l(w),N=a(629),k=l(N),x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},U=function(){function e(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,a,l){return a&&e(t.prototype,a),l&&e(t,l),t}}();a(628),a(43),a(643),a(101),a(299),a(102),a(644),a(57),a(61),a(631);var I=a(1),O=l(I);a(686);var T=a(687),D=l(T),M=a(663),j=(a(670),a(795)),H=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(j),A=a(626),q=l(A);a(796);var z=k.default.Option,V=function(e){return O.default.createElement("div",null,O.default.createElement(S.default,{type:"plus"}),O.default.createElement("div",{className:"ant-upload-text"},e))},G=function(e){function t(e){i(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={courseId:e.match.params.courseId||"",previewVisible:!1,previewImage:"",fileList:[],fileList1:[],fileListDetail:[],loading:!1,appleProductId:"",courseTitle:"",description:"",themePicUrl:"",materials:"",relayUrl:"",catalogId:"",androidSalesPrice:0,androidCostPrice:0,costPrice:0,salesPrice:"",qrCodePicUrl:"",weixin_group_pic_url:"",teacherName:"",typeData:[],courseInfo:{},appleProductList:[],editorState:D.default.createEditorState()},a}return s(t,e),U(t,[{key:"componentDidMount",value:function(){setTimeout(function(){},0),this.getCourseType(),this._getAppleProductList()}},{key:"getCourseType",value:function(){var e=this;H.getCourseType().then(function(t){200===t.code?e.setState({typeData:t.data}):b.default.error(t.msg)}).catch(function(e){})}},{key:"handlePreview",value:function(e){this.setState({previewImage:e.response.data.fileUrl,previewVisible:!0})}},{key:"imgHandleCancel",value:function(){this.setState({previewVisible:!1})}},{key:"upLoadChange",value:function(e){var t=e.fileList;this.setState({fileList:t}),t.length&&"done"===t[0].status?(b.default.success(t[0].name+" 上传成功！"),this.setState({themePicUrl:t[0].response.data.key})):t.length&&"error"===t[0].status&&b.default.error(t[0].name+" 上传失败！")}},{key:"upLoadChangeDetail",value:function(e){this.setState({fileListDetail:e.fileList}),e.fileList.length&&(this.state.fileListDetail.length&&"done"===this.state.fileListDetail[0].status?(b.default.success(this.state.fileListDetail[0].name+" 上传成功！"),this.setState({qrCodePicUrl:this.state.fileListDetail[0].response.data.key})):this.state.fileListDetail[0].length&&"error"===this.state.fileListDetail[0].status&&b.default.error(this.state.fileListDetail[0].name+" 上传失败！"))}},{key:"upLoadChange1",value:function(e){this.setState({fileList1:e.fileList}),e.fileList.length&&(this.state.fileList1.length&&"done"===this.state.fileList1[0].status?(b.default.success(this.state.fileList1[0].name+" 上传成功！"),this.setState({weixin_group_pic_url:this.state.fileList1[0].response.data.key})):this.state.fileList1[0].length&&"error"===this.state.fileList1[0].status&&b.default.error(this.state.fileList1[0].name+" 上传失败！"))}},{key:"selectChange",value:function(e){this.setState({catalogId:e})}},{key:"cancel",value:function(){this.props.history.push("courseList")}},{key:"inputChange",value:function(e,t){this.setState(n({},t,e.target.value))}},{key:"inputAndroidSalesPriceChange",value:function(e){this.setState({androidSalesPrice:e})}},{key:"inputAndroidCostPriceChange",value:function(e){this.setState({androidCostPrice:e})}},{key:"inputIosCostPriceChange",value:function(e){this.setState({costPrice:e})}},{key:"_getAppleProductList",value:function(){var e=this;H.getAppleProductList().then(function(t){200===t.code?e.setState({appleProductList:t.data}):b.default.error(t.msg)})}},{key:"appleListSelectChange",value:function(e){this.setState({salesPrice:e.label,appleProductId:e.key})}},{key:"submit",value:function(){var e=this,t={appleProductId:this.state.appleProductId||"",catalogId:this.state.catalogId||"",androidCostPrice:this.state.androidCostPrice||0,androidSalesPrice:this.state.androidSalesPrice||0,costPrice:this.state.costPrice||0,salesPrice:this.state.salesPrice||0,courseTitle:this.state.courseTitle||"",description:this.state.description||"",materials:this.state.outputHTML||"",themePicUrl:this.state.themePicUrl,weixinGroupPicUrl:this.state.weixin_group_pic_url||""};return this.state.teacherName&&(t.teacherName=this.state.teacherName),this.state.qrCodePicUrl&&(t.qrCodePicUrl=this.state.qrCodePicUrl),this.state.weixinGroupPicUrl&&(t.weixinGroupPicUrl=this.state.weixinGroupPicUrl),this.state.relayUrl&&(t.relayUrl=this.state.relayUrl),this.state.courseTitle?this.state.description?this.state.fileList.length?this.state.editorState.toText().length?this.state.catalogId?""==this.state.androidSalesPrice&&0!=this.state.androidSalesPrice?void b.default.error("请选择安卓售价"):void H.addCourse(t).then(function(t){200===t.code?(b.default.success("保存成功",.8),setTimeout(function(){e.props.history.push("/courseList")},1e3)):b.default.error(t.msg)}):void b.default.error("请选择课程类别"):void b.default.error("请填写课程详情"):void b.default.error("请选择上传课程封面"):void b.default.error("请填写课程简介"):void b.default.error("请填写课程名称")}},{key:"componentWillUnmount",value:function(){this.isLivinig=!1}},{key:"setEditorContentAsync",value:function(){this.isLivinig&&this.setState({editorState:D.default.createEditorState()})}},{key:"handleEditorChange",value:function(e){this.setState({editorState:e,outputHTML:""+e.toHTML()})}},{key:"uploadHandler",value:function(e){var t=this;if(!e.file)return!1;e.file.size>1048576&&b.default.error("上传的图片不能超过1MB");var a=new XMLHttpRequest,l=new FormData;l.append("inputFile",e.file),a.open("POST","http://39.98.32.147:58081/course/admin/file-upload/upload-img",!0),a.setRequestHeader("token",""+_.getStore("tz_token")),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=JSON.parse(a.response);t.setState({editorState:M.ContentUtils.insertMedias(t.state.editorState,[{type:"IMAGE",url:e.data.fileUrl.split("?")[0]}])}),b.default.success("图片添加成功",1)}},a.send(l)}},{key:"render",value:function(){var e=this,t={name:"inputFile",action:"http://39.98.32.147:58081/course/admin/file-upload/upload-img",listType:"picture-card",headers:{token:_.getStore("tz_token")}},a=this.state,l=a.previewVisible,n=a.previewImage,i=a.fileList,r=a.fileList1,s=a.fileListDetail,u=this.state,c=u.editorState,f=(u.outputHTML,[{key:"antd-uploader",type:"component",component:O.default.createElement(C.default,{accept:"image/*",showUploadList:!1,customRequest:function(t){return e.uploadHandler(t)}},O.default.createElement("button",{type:"button",className:"control-item button upload-button","data-title":"插入图片"},O.default.createElement(S.default,{type:"picture",theme:"filled"})))}]),m=["media"];return O.default.createElement("div",null,O.default.createElement(q.default,{title:"课程列表 / 添加课程"}),O.default.createElement("div",{className:"addCourse-wrap"},O.default.createElement("h1",null,"课程内容"),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"课程名称")),O.default.createElement(y.default,{span:16},O.default.createElement(g.default,{size:"large",value:this.state.courseTitle,onChange:function(t){return e.inputChange(t,"courseTitle")},placeholder:"请输入课程名称"})))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"课程简介")),O.default.createElement(y.default,{span:16},O.default.createElement(g.default,{size:"large",value:this.state.description,onChange:function(t){return e.inputChange(t,"description")},placeholder:"请输入课程简介"})))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"课程封面图")),O.default.createElement(y.default,{span:16},O.default.createElement(C.default,x({},t,{fileList:i,onPreview:function(t){return e.handlePreview(t)},onChange:function(t){return e.upLoadChange(t)}}),i.length<1?V("课程封面"):null)))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"课程详情图")),O.default.createElement(y.default,{span:16},O.default.createElement(C.default,x({},t,{fileList:s,onPreview:function(t){return e.handlePreview(t)},onChange:function(t){return e.upLoadChangeDetail(t)}}),s.length<1?V("课程详情图"):null)))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"课程详情")),O.default.createElement(y.default,{span:16},O.default.createElement("div",{className:"editor-wrapper"},O.default.createElement(D.default,{placehoder:"请输入内容...",value:c,onChange:function(t){return e.handleEditorChange(t)},excludeControls:m,extendControls:f,contentStyle:{height:300,boxShadow:"0px 1px 1px 1px rgba(0,0,0,.1)"}}))))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"选择类别")),O.default.createElement(y.default,{span:16},O.default.createElement(k.default,{defaultValue:"请选择",style:{width:120},onChange:this.selectChange.bind(this)},this.state.typeData.map(function(e,t){return O.default.createElement(z,{key:e,value:e.catalogId},e.catalogName)}))))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"转发url")),O.default.createElement(y.default,{span:16},O.default.createElement(g.default,{size:"large",value:this.state.relayUrl,onChange:function(t){return e.inputChange(t,"relayUrl")},placeholder:"请输入转发url"})))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"安卓销售价")),O.default.createElement(y.default,{span:6},O.default.createElement(p.default,{costPrice:!0,min:0,max:1e4,step:.01,value:this.state.androidSalesPrice,onChange:function(t){return e.inputAndroidSalesPriceChange(t)}})),O.default.createElement(y.default,{span:3,className:"title",style:{marginLeft:15}},O.default.createElement("span",null,"安卓划线价")),O.default.createElement(y.default,{span:6},O.default.createElement(p.default,{min:0,max:1e4,step:.01,value:this.state.androidCostPrice,onChange:function(t){return e.inputAndroidCostPriceChange(t)}})))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"iOS销售价")),O.default.createElement(y.default,{span:6},O.default.createElement(k.default,{labelInValue:!0,style:{width:120},defaultValue:{key:"免费",label:null},onChange:function(t){return e.appleListSelectChange(t)}},this.state.appleProductList.map(function(e,t){return O.default.createElement(z,{key:e.id,value:e.id},e.title)}))),O.default.createElement(y.default,{span:3,className:"title",style:{marginLeft:15}},O.default.createElement("span",null,"iOS划线价")),O.default.createElement(y.default,{span:6},O.default.createElement(p.default,{min:0,max:1e4,step:.01,value:this.state.costPrice,onChange:function(t){return e.inputIosCostPriceChange(t)}})))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"老师")),O.default.createElement(y.default,{span:16},O.default.createElement(g.default,{size:"large",value:this.state.teacherName,onChange:function(t){return e.inputChange(t,"teacherName")},placeholder:"请输入老师姓名"})))),O.default.createElement("div",{className:"rowbox"},O.default.createElement(h.default,null,O.default.createElement(y.default,{span:4,className:"title"},O.default.createElement("span",null,"加群聊天")),O.default.createElement(y.default,{span:16},O.default.createElement(C.default,x({},t,{fileList:r,onPreview:function(t){return e.handlePreview(t)},onChange:function(t){return e.upLoadChange1(t)}}),r.length<1?V("二维码图片"):null)))),O.default.createElement("div",{className:"rowbox"},O.default.createElement("div",{className:"btn-group"},O.default.createElement(d.default,{onClick:function(){return e.cancel()}},"取消"),O.default.createElement(d.default,{type:"primary",className:"save-btn",onClick:function(){return e.submit()}},"保存")))),O.default.createElement(o.default,{visible:l,footer:null,onCancel:function(t){return e.imgHandleCancel(t)}},O.default.createElement("img",{alt:"image",style:{width:"100%"},src:n})))}}]),t}(O.default.Component);t.default=G}});