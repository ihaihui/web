webpackJsonp([13],{613:function(e,t,s){"use strict";(function(e){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=s(627),l=o(r),c=s(634),d=o(c),h=s(300),p=o(h),f=s(99),g=o(f),y=s(100),C=o(y),m=s(42),v=o(m),I=s(56),k=o(I),b=s(629),S=o(b),E=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}();s(628),s(635),s(299),s(101),s(102),s(43),s(57),s(631);var w=s(626),R=o(w),j=s(792),L=a(j),T=s(740),M=a(T),x=s(794),_=a(x);s(793);var O=S.default.Option,D=function(t){function s(t){n(this,s);var a=i(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t));return a.state={columns:[{title:"课程名称",dataIndex:"courseTitle",key:"courseTitle"},{title:"更新期数",dataIndex:"description",key:"description"},{title:"购买量",dataIndex:"salesCounts",key:"salesCounts"},{title:"分类",dataIndex:"catalogName",key:"catalogName"},{title:"状态",dataIndex:"courseState",key:"courseState",render:function(e){return"release"===e?"上架":"下架"}},{title:"操作",key:"action",filter:!1,render:function(t,s){switch(a.props.location.state.source){case"gooseList":return e.createElement("a",{onClick:function(){return a.goRelation(s)}},"去关联");case"userList":return e.createElement("a",{onClick:function(){return a.goRelationUser(s)}},"去关联");case"subjectManage":return e.createElement("a",{onClick:function(){return a.goRelationSubject(s)}},"去添加");case"addCoupon":case"editCoupon":default:return e.createElement("a",null)}}}],courseList:[],courseTitle:"",hasTzCourseId:"",xetCourseId:"",tzCourseId:"",page:0,limit:10,visible:!1,inputValue:"",loading:!0,totalCount:1,courseState:"",infoMsg:"--",selectedRowKeys:[],selectedRows:[],couponCourseList:[],selectIds:[],selectButtonFlag:!1},a}return u(s,t),E(s,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){"gooseList"===this.props.location.state.source&&this.getInitialXetData(),"addCoupon"===this.props.location.state.source&&(this.getInitialCouponData(),this.setState({source:this.props.location.state.source,couponId:this.props.location.state.couponId||"",selectButtonFlag:!0})),"editCoupon"===this.props.location.state.source&&(this.getInitialCouponData(),this.setState({source:this.props.location.state.source,couponId:this.props.location.state.couponId||"",selectButtonFlag:!0})),"userList"===this.props.location.state.source&&this.getInitialUserData(),"subjectManage"===this.props.location.state.source&&this.getInitialSubjectData(),this._getCourseList()}},{key:"_getCourseList",value:function(){var e=this,t={page:this.state.page,limit:this.state.limit};L.getCourseList(t).then(function(t){e.setState({courseList:t.data.list,loading:!1,totalCount:t.data.totalCount})})}},{key:"getInitialXetData",value:function(){var e=this.props.location.state;this.setState({xetCourseTitle:e.courseTitle,xetCourseId:e.xetCourseId})}},{key:"getInitialCouponData",value:function(){var e=this.props.location.state;this.setState({selectedRowKeys:e.data})}},{key:"getInitialUserData",value:function(){var e=this.props.location.state;this.setState({nickName:e.nickName,userId:e.userId})}},{key:"getInitialSubjectData",value:function(){var e=this.props.location.state;this.setState({secondSubjectId:e.secondSubjectId})}},{key:"inputChangeValue",value:function(e){this.setState({inputValue:e.target.value})}},{key:"goRelation",value:function(e){this.setState({tzCourseId:e.courseId,xetCourseId:this.state.xetCourseId,infoMsg:"确定将小鹅通课程《"+this.state.xetCourseTitle+"》 关联到 《"+e.courseTitle+"》？"}),this.showModal()}},{key:"goRelationUser",value:function(e){this.setState({courseId:e.courseId,infoMsg:"确定将课程《"+e.courseTitle+'》 关联到用户昵称为："'+this.state.nickName+'"？(关联成功的课程请到："课程管理-订阅列表" 中查看)'}),this.showModal()}},{key:"goRelationSubject",value:function(e){this.setState({courseId:e.courseId,infoMsg:"确定将该课程《"+e.courseTitle+"》 进行添加到主题操作？"}),this.showModal()}},{key:"sureRelation",value:function(e,t){var s=this,a={tzCourseId:e,xetCourseId:t};L.relationGooseCourse(a).then(function(e){var t=s;200===e.code&&(k.default.success("关联成功",.8),setTimeout(function(){t.props.history.push("/gooseList")},1e3))})}},{key:"sureRelationUser",value:function(e,t){var s=this,a={courseId:this.state.courseId,userId:this.state.userId};M.relationCourseToUser(a).then(function(e){var t=s;200===e.data.code&&(k.default.success("关联成功",.8),setTimeout(function(){t.props.history.push("/userList")},1e3))})}},{key:"sureRelationSubject",value:function(){var e=this,t={courseId:this.state.courseId,subjectId:this.state.secondSubjectId};_.addCourseToSubject(t).then(function(t){var s=e;200===t.data.code&&(k.default.success("添加成功",.8),setTimeout(function(){s.props.history.push("/subjectManage")},1e3))}).catch(function(e){k.default.error(e.data.msg,.8)})}},{key:"pageChange",value:function(e){var t=this;this.setState({page:e,loading:!0},function(){L.getCourseList({page:t.state.page,limit:t.state.limit}).then(function(e){t.setState({courseList:e.data.list,loading:!1,totalCount:e.data.totalCount})})})}},{key:"selsectChange",value:function(e){this.setState({courseState:e})}},{key:"searchCourseList",value:function(e){var t=this,s={courseTitle:this.state.inputValue,courseState:this.state.courseState};this.setState({loading:!0}),L.getCourseList(s).then(function(e){t.setState({courseList:e.data.list,loading:!1,totalCount:e.data.totalCount})})}},{key:"showModal",value:function(e,t,s){this.setState({visible:!0,deleteData:t})}},{key:"handleOk",value:function(e){"gooseList"===this.props.location.state.source?this.sureRelation(this.state.tzCourseId,this.state.xetCourseId):"userList"===this.props.location.state.source?this.sureRelationUser():"subjectManage"===this.props.location.state.source&&this.sureRelationSubject(),this.setState({visible:!1})}},{key:"handleCancel",value:function(){this.setState({visible:!1})}},{key:"onCheckChange",value:function(e,t){this.setState({selectedRowKeys:e})}},{key:"selectCouponCourse",value:function(){}},{key:"sureSelectCouponCourse",value:function(){var e={pathname:this.state.source,state:{data:this.state.selectedRowKeys,source:"selectCourse",couponId:this.state.couponId||""}};this.props.history.push(e)}},{key:"render",value:function(){var t=this,s={selectedRowKeys:this.state.selectedRowKeys,onChange:this.onCheckChange.bind(this)},a=(this.state.selectedRowKeys.length,e.createElement(g.default,{style:{marginTop:15}},e.createElement(C.default,{span:2,style:{marginRight:20}},e.createElement(v.default,{type:"primary",onClick:function(){return t.sureSelectCouponCourse()},disabled:!this.state.selectedRowKeys.length},"选择完毕")),e.createElement(C.default,{span:6,style:{marginTop:5}},"已选",e.createElement("b",null,this.state.selectedRowKeys.length),"门")));return e.createElement("div",null,e.createElement(R.default,{title:"课程管理 / 小鹅通课程 / 关联课程"}),e.createElement("div",{className:"gooseList-wrap"},e.createElement(g.default,null,e.createElement(C.default,{span:8}),e.createElement(C.default,{span:5},e.createElement("span",{style:{marginRight:20}},"课程状态:"),e.createElement(S.default,{defaultValue:"请选择",style:{width:120},onChange:function(e){return t.selsectChange(e)}},e.createElement(O,{value:"release"},"上架"),e.createElement(O,{value:"unrelease"},"下架"))),e.createElement(C.default,{span:8},e.createElement("span",{style:{margin:10}},"课程名称:"),e.createElement(p.default,{style:{width:"240px"},placeholder:"请输入课程名称",value:this.state.inputValue,onChange:function(e){return t.inputChangeValue(e)}})),e.createElement(C.default,{span:2},e.createElement(v.default,{type:"primary",onClick:function(){return t.searchCourseList()}},"查询"))),this.state.selectButtonFlag?a:null,e.createElement(g.default,{style:{marginTop:25}},e.createElement(d.default,{rowSelection:this.state.selectButtonFlag?s:null,columns:this.state.columns,rowKey:function(e){return e.courseId},dataSource:this.state.courseList,loading:this.state.loading,pagination:{defaultPageSize:this.state.limit,current:this.state.page,total:this.state.totalCount,onChange:this.pageChange.bind(this)}})),e.createElement(l.default,{title:"关联小鹅通课程",visible:this.state.visible,footer:[e.createElement(v.default,{key:"back",onClick:function(){return t.handleCancel()}},"取消"),e.createElement(v.default,{key:"submit",type:"primary",onClick:function(){return t.handleOk()}},"确定")]},e.createElement("p",null,this.state.infoMsg))))}}]),s}(e.Component);t.default=D}).call(t,s(1))}});