webpackJsonp([20],{617:function(e,t,a){"use strict";(function(e){function l(e){return e&&e.__esModule?e:{default:e}}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(627),c=l(o),u=a(42),d=l(u),p=a(641),f=l(p),m=a(99),h=l(m),g=a(300),v=l(g),E=a(100),y=l(E),P=a(642),C=l(P),L=a(56),w=l(L),b=a(12),S=l(b),x=a(629),N=l(x),k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},I=function(){function e(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,a,l){return a&&e(t.prototype,a),l&&e(t,l),t}}();a(628),a(43),a(643),a(101),a(299),a(102),a(644),a(57),a(61),a(631),a(686);var U=a(687),T=l(U),D=a(663),O=(a(670),a(795)),q=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(O),K=a(626),M=l(K);a(796);var j=N.default.Option,H=function(t){return e.createElement("div",null,e.createElement(S.default,{type:"plus"}),e.createElement("div",{className:"ant-upload-text"},t))},A=function(t){function a(e){i(this,a);var t=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={courseId:e.match.params.courseId||"",previewVisible:!1,previewImage:"",fileList:[],fileList1:[],fileListDetail:[],loading:!1,appleProductId:"",courseTitle:"",description:"",themePicUrl:"",themePicKey:"",materials:"",relayUrl:"",catalogId:"",androidSalesPrice:"",androidCostPrice:0,costPrice:0,salesPrice:"",qrCodePicUrl:"",qrCodePicKey:"",weixin_group_pic_url:"",weixin_group_pic_urlKey:"",teacherName:"",typeData:[],appleProductList:[],editorState:T.default.createEditorState()},t}return s(a,t),I(a,[{key:"componentDidMount",value:function(){this.getCourseInfo(),this.getCourseType(),this._getAppleProductList()}},{key:"getCourseInfo",value:function(){var e=this;if(0!=this.props.location.state.courseId){var t={courseId:this.props.location.state.record.courseId};q.getCourseInfo(t).then(function(t){200===t.code?(e.setState({appleProductId:t.data.appleProductId,courseState:t.data.courseState,courseTitle:t.data.courseTitle,description:t.data.description,fileList:[{uid:"-1",name:"xxx.png",status:"done",response:{data:{fileUrl:t.data.themePicUrl}},url:t.data.themePicUrl}],editorState:T.default.createEditorState(t.data.materials),relayUrl:t.data.relayUrl?t.data.relayUrl:"",catalogId:t.data.catalogId,catalogName:e.props.location.state.record.catalogName,androidCostPrice:t.data.androidCostPrice||0,androidSalesPrice:t.data.androidSalesPrice,salesPrice:t.data.salesPrice,costPrice:t.data.costPrice||0,teacherName:t.data.teacherName?t.data.teacherName:""}),t.data.qrCodePicUrl&&e.setState({fileListDetail:[{uid:"-1",name:"xxx.png",status:"done",response:{data:{fileUrl:t.data.qrCodePicUrl}},url:t.data.qrCodePicUrl}]}),t.data.weixinGroupPicUrl&&e.setState({fileList1:[{uid:"-1",name:"xxx.png",status:"done",response:{data:{fileUrl:t.data.weixinGroupPicUrl}},url:t.data.weixinGroupPicUrl}]})):w.default.destroy()})}}},{key:"getCourseType",value:function(){var e=this;q.getCourseType().then(function(t){200===t.code?e.setState({typeData:t.data}):w.default.error(t.msg)}).catch(function(e){})}},{key:"handlePreview",value:function(e){this.setState({previewImage:e.response.data.fileUrl,previewVisible:!0})}},{key:"imgHandleCancel",value:function(){this.setState({previewVisible:!1})}},{key:"upLoadChange",value:function(e){var t=e.fileList;this.setState({fileList:t}),t.length&&"done"===t[0].status?(w.default.success(t[0].name+" 上传成功！"),this.setState({themePicKey:t[0].response.data.key})):t.length&&"error"===t[0].status&&w.default.error(t[0].name+" 上传失败！")}},{key:"upLoadChangeDetail",value:function(e){this.setState({fileListDetail:e.fileList}),e.fileList.length&&(this.state.fileListDetail.length&&"done"===this.state.fileListDetail[0].status?(w.default.success(this.state.fileListDetail[0].name+" 上传成功！"),this.setState({qrCodePicKey:this.state.fileListDetail[0].response.data.key})):this.state.fileListDetail[0].length&&"error"===this.state.fileListDetail[0].status&&w.default.error(this.state.fileListDetail[0].name+" 上传失败！"))}},{key:"upLoadChange1",value:function(e){this.setState({fileList1:e.fileList}),e.fileList.length&&(this.state.fileList1.length&&"done"===this.state.fileList1[0].status?(w.default.success(this.state.fileList1[0].name+" 上传成功！"),this.setState({weixin_group_pic_urlKey:this.state.fileList1[0].response.data.key})):this.state.fileList1[0].length&&"error"===this.state.fileList1[0].status&&w.default.error(this.state.fileList1[0].name+" 上传失败！"))}},{key:"selectChange",value:function(e){this.setState({catalogId:e.key,catalogName:e.label})}},{key:"cancel",value:function(){this.props.history.push("courseList")}},{key:"inputChange",value:function(e,t){this.setState(n({},t,e.target.value))}},{key:"inputAndroidSalesPriceChange",value:function(e){this.setState({androidSalesPrice:e})}},{key:"inputAndroidCostPriceChange",value:function(e){this.setState({androidCostPrice:e})}},{key:"inputIosCostPriceChange",value:function(e){this.setState({costPrice:e})}},{key:"_getAppleProductList",value:function(){var e=this;q.getAppleProductList().then(function(t){200===t.code?e.setState({appleProductList:t.data}):w.default.error(t.msg)})}},{key:"appleListSelectChange",value:function(e){this.setState({salesPrice:e.label,appleProductId:e.key})}},{key:"submit",value:function(){var e=this,t={courseId:this.props.location.state.record.courseId,courseState:this.state.courseState,appleProductId:this.state.appleProductId||"",catalogId:this.state.catalogId||"",androidCostPrice:this.state.androidCostPrice||0,androidSalesPrice:this.state.androidSalesPrice||0,costPrice:this.state.costPrice||0,salesPrice:this.state.salesPrice||0,courseTitle:this.state.courseTitle||"",description:this.state.description||"",materials:this.state.outputHTML||"",teacherName:this.state.teacherName||"",relayUrl:this.state.relayUrl||""};return this.state.themePicKey&&(t.themePicUrl=this.state.themePicKey),this.state.qrCodePicKey?t.qrCodePicUrl=this.state.qrCodePicKey:this.state.qrCodePicKey||this.state.fileListDetail.length||(t.qrCodePicUrl=""),this.state.weixin_group_pic_urlKey?t.weixinGroupPicUrl=this.state.weixin_group_pic_urlKey:this.state.weixin_group_pic_urlKey||this.state.fileList1.length||(t.weixinGroupPicUrl=""),this.state.courseTitle?this.state.description?this.state.fileList.length?this.state.fileListDetail.length?this.state.editorState.toText().length?this.state.catalogId?void q.addCourse(t).then(function(t){200===t.code?(e.setState({loading:!1}),w.default.success("保存成功",.8),setTimeout(function(){e.props.history.push("/courseList")},1e3)):w.default.error(t.msg)}):void w.default.error("请选择课程类别"):void w.default.error("请填写课程详情"):void w.default.error("请课程详情图片"):void w.default.error("请选择上传课程封面"):void w.default.error("请填写课程简介"):void w.default.error("请填写课程名称")}},{key:"componentWillUnmount",value:function(){this.isLivinig=!1}},{key:"handleEditorChange",value:function(e){this.setState({editorState:e,outputHTML:""+e.toHTML()})}},{key:"uploadHandler",value:function(e){var t=this;if(!e.file)return!1;e.file.size>1048576&&w.default.error("上传的图片不能超过1MB");var a=new XMLHttpRequest,l=new FormData;l.append("inputFile",e.file),a.open("POST","http://39.98.32.147:58081/course/admin/file-upload/upload-img",!0),a.setRequestHeader("token",""+_.getStore("tz_token")),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=JSON.parse(a.response);t.setState({editorState:D.ContentUtils.insertMedias(t.state.editorState,[{type:"IMAGE",url:e.data.fileUrl.split("?")[0]}])}),w.default.success("图片添加成功",1)}},a.send(l)}},{key:"render",value:function(){var t=this,a={name:"inputFile",action:"http://39.98.32.147:58081/course/admin/file-upload/upload-img",listType:"picture-card",headers:{token:_.getStore("tz_token")}},l=this.state,n=l.previewVisible,i=l.previewImage,r=l.fileList,s=l.fileList1,o=l.fileListDetail,u=this.state,p=u.editorState,m=(u.outputHTML,[{key:"antd-uploader",type:"component",component:e.createElement(C.default,{accept:"image/*",showUploadList:!1,customRequest:function(e){return t.uploadHandler(e)}},e.createElement("button",{type:"button",className:"control-item button upload-button","data-title":"插入图片"},e.createElement(S.default,{type:"picture",theme:"filled"})))}]),g=["media"];return e.createElement("div",null,e.createElement(M.default,{title:"课程列表 / 编辑课程"}),e.createElement("div",{className:"addCourse-wrap"},e.createElement("h1",null,"课程内容"),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"课程名称")),e.createElement(y.default,{span:16},e.createElement(v.default,{size:"large",value:this.state.courseTitle,onChange:function(e){return t.inputChange(e,"courseTitle")},placeholder:"请输入课程名称"})))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"课程简介")),e.createElement(y.default,{span:16},e.createElement(v.default,{size:"large",value:this.state.description,onChange:function(e){return t.inputChange(e,"description")},placeholder:"请输入课程简介"})))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"课程封面图")),e.createElement(y.default,{span:16},e.createElement(C.default,k({},a,{fileList:r,onPreview:function(e){return t.handlePreview(e)},onChange:function(e){return t.upLoadChange(e)}}),r.length<1?H("课程封面"):null)))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"课程详情图")),e.createElement(y.default,{span:16},e.createElement(C.default,k({},a,{fileList:o,onPreview:function(e){return t.handlePreview(e)},onChange:function(e){return t.upLoadChangeDetail(e)}}),o.length<1?H("课程详情图"):null)))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"课程详情")),e.createElement(y.default,{span:16},e.createElement("div",{className:"editor-wrapper"},e.createElement(T.default,{placehoder:"请输入内容...",value:p,onChange:function(e){return t.handleEditorChange(e)},excludeControls:g,extendControls:m,contentStyle:{height:300,boxShadow:"0px 1px 1px 1px rgba(0,0,0,.1)"}}))))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"选择类别")),e.createElement(y.default,{span:16},e.createElement(N.default,{labelInValue:!0,value:{key:""+this.state.catalogName},style:{width:120},onChange:this.selectChange.bind(this)},this.state.typeData.map(function(t,a){return e.createElement(j,{key:t,value:t.catalogId},t.catalogName)}))))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"转发url")),e.createElement(y.default,{span:16},e.createElement(v.default,{size:"large",value:this.state.relayUrl,onChange:function(e){return t.inputChange(e,"relayUrl")},placeholder:"请输入转发url"})))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"安卓销售价")),e.createElement(y.default,{span:6},e.createElement(f.default,{min:0,max:1e4,step:.01,value:this.state.androidSalesPrice,onChange:function(e){return t.inputAndroidSalesPriceChange(e)}})),e.createElement(y.default,{span:3,className:"title",style:{marginLeft:15}},e.createElement("span",null,"安卓划线价")),e.createElement(y.default,{span:6},e.createElement(f.default,{min:0,max:1e4,step:.01,value:this.state.androidCostPrice,onChange:function(e){return t.inputAndroidCostPriceChange(e)}})))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"iOS销售价")),e.createElement(y.default,{span:6},e.createElement(N.default,{labelInValue:!0,value:{key:""+this.state.salesPrice},style:{width:120},onChange:function(e){return t.appleListSelectChange(e)}},this.state.appleProductList.map(function(t,a){return e.createElement(j,{key:a,value:t.id},t.title)}))),e.createElement(y.default,{span:3,className:"title",style:{marginLeft:15}},e.createElement("span",null,"iOS划线价")),e.createElement(y.default,{span:6},e.createElement(f.default,{min:0,max:1e4,step:.01,value:this.state.costPrice,onChange:function(e){return t.inputIosCostPriceChange(e)}})))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"老师")),e.createElement(y.default,{span:16},e.createElement(v.default,{size:"large",value:this.state.teacherName,onChange:function(e){return t.inputChange(e,"teacherName")},placeholder:"请输入老师姓名"})))),e.createElement("div",{className:"rowbox"},e.createElement(h.default,null,e.createElement(y.default,{span:4,className:"title"},e.createElement("span",null,"加群聊天")),e.createElement(y.default,{span:16},e.createElement(C.default,k({},a,{fileList:s,onPreview:function(e){return t.handlePreview(e)},onChange:function(e){return t.upLoadChange1(e)}}),s.length<1?H("二维码图片"):null)))),e.createElement("div",{className:"rowbox"},e.createElement("div",{className:"btn-group"},e.createElement(d.default,{onClick:function(){return t.cancel()}},"取消"),e.createElement(d.default,{type:"primary",className:"save-btn",onClick:function(){return t.submit()}},"保存")))),e.createElement(c.default,{visible:n,footer:null,onCancel:function(e){return t.imgHandleCancel(e)}},e.createElement("img",{alt:"image",style:{width:"100%"},src:i})))}}]),a}(e.Component);t.default=A}).call(t,a(1))}});